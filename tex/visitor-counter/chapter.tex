\chapter{Счётчик посетителей}

Помните старые времена интернета, когда не было ни одного сайта без
маленькой бирки <<вы посетитель номер 32>>? Ах, это были хорошие времена!
Давайте воспроизведём этот замечательный опыт на Yesod!

Теперь, если бы мы хотели сделать всё правильно, мы бы хранили эту информацию в
какой форме в постоянном хранилище, например, базе данных, чтобы информация
могла разделяться между множество горизонтально масштабированных веб-серверов
и могла пережить перезапуск приложения.

Но наша цель не продемонстрировать хорошую практику (если бы это было целью, не
стоило бы демонстрировать счётчик посетителей, не так ли?). Наша же цель~---
предоставить простой пример разделения некоторого состояния между множеством
обработчиков. Примером из реального мира могло бы стать кеширование информации
между запросами. Просто помните, что, когда вы будете использовать технику,
которую мы покажем, вам потребуется учитывать наличие множества серверов
приложений и возможность перезапуска приложения.

\sourcecode{visitor-counter}{visitor-counter.hs}

Я использовал значение типа \lstinline'IORef', так как нам не требуется более
того, что оно предоставляет, но вы также можете использовать~\lstinline'MVar'
или~\lstinline'TVar'. В принципе, это хорошее упражнение для читателя~---
изменить программу так, чтобы для счётчика посетителей
использовать~\lstinline'TVar'.
